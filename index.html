<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>é«˜çŸ¥å¸‚ã‚°ãƒ«ãƒ¡ãƒãƒƒãƒ— - å®Œå…¨ç‰ˆ</title>
    <link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css" />
    <style>
        body { margin: 0; padding: 0; font-family: 'Helvetica Neue', Arial, sans-serif; display: flex; height: 100vh; overflow: hidden; }
        #sidebar { width: 350px; background: #f8f9fa; border-right: 1px solid #ddd; display: flex; flex-direction: column; z-index: 2000; }
        .sidebar-header { padding: 15px; background: #fff; border-bottom: 2px solid #3498db; }
        
        .sort-select { width: 100%; padding: 8px; margin-top: 10px; border-radius: 4px; border: 1px solid #ccc; font-size: 0.85em; background: #fff; }

        #shop-list { flex: 1; overflow-y: auto; padding: 10px; }
        .shop-item { background: white; padding: 12px; margin-bottom: 8px; border-radius: 6px; box-shadow: 0 1px 3px rgba(0,0,0,0.1); cursor: pointer; border-left: 4px solid transparent; }
        .shop-item:hover { border-left-color: #3498db; background: #f0f7ff; }
        
        .status-badge, .cat-badge { display: inline-block; padding: 2px 8px; border-radius: 4px; font-size: 0.75em; font-weight: bold; }
        .status-badge { border-radius: 12px; margin-left: 5px; }
        .open { background: #2ecc71; color: white; }
        .closed { background: #7f8c8d; color: white; }
        .cat-badge { color: white; margin-right: 5px; min-width: 85px; text-align: center; }
        
        /* ãƒ¬ã‚¹ãƒˆãƒ©ãƒ³(é»„è‰²)ã®æ–‡å­—è‰²èª¿æ•´ */
        .cat-yellow { color: #333 !important; }

        .time-text { font-size: 0.8em; color: #555; margin-top: 6px; display: block; }

        #map-container { flex: 1; position: relative; }
        #map { height: 100%; width: 100%; }
        
        .control-panel { 
            position: absolute; top: 10px; right: 10px; z-index: 1000; 
            background: rgba(255,255,255,0.95); padding: 12px; border-radius: 8px; 
            width: 170px; box-shadow: 0 2px 15px rgba(0,0,0,0.1);
        }
        .filter-label { font-size: 0.8em; font-weight: bold; margin: 12px 0 6px; display: block; color: #444; border-left: 3px solid #3498db; padding-left: 5px; }
        .filter-label:first-child { margin-top: 0; }
        
        .filter-btn { display: block; width: 100%; background: white; border: 1px solid #ddd; padding: 5px; margin-bottom: 4px; cursor: pointer; border-radius: 4px; font-size: 0.75em; text-align: center; transition: 0.2s; }
        .filter-btn.active { background: #3498db; color: white; border-color: #2980b9; font-weight: bold; }
    </style>
</head>
<body>

<div id="sidebar">
    <div class="sidebar-header">
        <h2 style="margin:0; font-size:1.1em;">é«˜çŸ¥å¸‚ã‚°ãƒ«ãƒ¡ãƒãƒƒãƒ—</h2>
        <select class="sort-select" onchange="updateSort(this.value)">
            <option value="high">è©•ä¾¡ãŒé«˜ã„é †</option>
            <option value="low">è©•ä¾¡ãŒä½ã„é †</option>
        </select>
    </div>
    <div id="shop-list"></div>
</div>

<div id="map-container">
    <div class="control-panel">
        <span class="filter-label">ã‚«ãƒ†ã‚´ãƒª</span>
        <button class="filter-btn active cat-f" onclick="updateCategory('ã™ã¹ã¦', this)">ã™ã¹ã¦</button>
        <button class="filter-btn cat-f" onclick="updateCategory('ã‚«ãƒ•ã‚§', this)">ã‚«ãƒ•ã‚§</button>
        <button class="filter-btn cat-f" onclick="updateCategory('ãƒ¬ã‚¹ãƒˆãƒ©ãƒ³', this)">ãƒ¬ã‚¹ãƒˆãƒ©ãƒ³</button>
        <button class="filter-btn cat-f" onclick="updateCategory('ãƒ‘ãƒ³ãƒ»ã‚±ãƒ¼ã‚­', this)">ãƒ‘ãƒ³ãƒ»ã‚±ãƒ¼ã‚­</button>
        
        <span class="filter-label">è©•ä¾¡ã§çµã‚Šè¾¼ã‚€</span>
        <button class="filter-btn active rat-f" onclick="updateRating(0, this)">ã™ã¹ã¦</button>
        <button class="filter-btn rat-f" onclick="updateRating(4.5, this)">â˜… 4.5 ä»¥ä¸Š</button>
        <button class="filter-btn rat-f" onclick="updateRating(4.0, this)">â˜… 4.0 ä»¥ä¸Š</button>
        <button class="filter-btn rat-f" onclick="updateRating(3.5, this)">â˜… 3.5 ä»¥ä¸Š</button>
    </div>
    <div id="map"></div>
</div>

<script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js"></script>
<script>
    // å…¨ãƒ‡ãƒ¼ã‚¿ï¼ˆæœ€æ–°è‰²è¨­å®šï¼‰
    const locations = [
        { name: "ãƒ¡ãƒ•ã‚£ã‚¹ãƒˆãƒ•ã‚§ãƒ¬ã‚¹", lat: 33.559475, lng: 133.535597, rating: 4.4, cat: "ã‚«ãƒ•ã‚§", color: "#e67e22", displayTime: "9:00ï½21:00", hours: { type: "weekly", weekday: ["09:00", "21:00"], weekend: ["08:00", "21:00"] } },
        { name: "ãƒ•ã‚¡ã‚¦ã‚¹ãƒˆ", lat: 33.559969, lng: 133.538814, rating: 3.9, cat: "ã‚«ãƒ•ã‚§", color: "#e67e22", displayTime: "9:00ï½18:00", hours: { type: "daily", range: [["09:00", "18:00"]] } },
        { name: "Cake CafÃ© 12ã‹æœˆ", lat: 33.539902, lng: 133.524018, rating: 3.9, cat: "ã‚«ãƒ•ã‚§", color: "#e67e22", displayTime: "9:00ï½17:00", hours: { type: "daily", range: [["09:00", "17:00"]] } },
        { name: "ã‚¤ã‚½ãƒƒãƒ—ã®å°æ‰€", lat: 33.566687, lng: 133.563023, rating: 3.9, cat: "ã‚«ãƒ•ã‚§", color: "#e67e22", displayTime: "9:00ï½21:00", hours: { type: "daily", range: [["09:00", "21:00"]] } },
        { name: "åœŸä½æ°´æœ¨", lat: 33.538415, lng: 133.485374, rating: 4.0, cat: "ã‚«ãƒ•ã‚§", color: "#e67e22", displayTime: "11:00ï½17:00", hours: { type: "daily", range: [["11:00", "17:00"]] } },
        { name: "ãƒŸãƒ¥ãƒ¼ã‚¸ã‚¢ãƒ ã‚«ãƒ•ã‚§ ãƒãƒ«ã‚¯", lat: 33.561311, lng: 133.573169, rating: 3.7, cat: "ã‚«ãƒ•ã‚§", color: "#e67e22", displayTime: "9:00ï½17:00", hours: { type: "daily", range: [["09:00", "17:00"]] } },
        { name: "ã‚«ãƒ•ã‚§ ãƒ‰ æ¢µ", lat: 33.560774, lng: 133.539175, rating: 3.7, cat: "ã‚«ãƒ•ã‚§", color: "#e67e22", displayTime: "11:30ï½23:00", hours: { type: "special_cafe_bon" } },
        { name: "ã‚«ãƒ•ã‚§ ã‚¬ã‚¦ãƒ‡ã‚£", lat: 33.549905, lng: 133.511054, rating: 4.0, cat: "ã‚«ãƒ•ã‚§", color: "#e67e22", displayTime: "7:00ï½14:00", hours: { type: "daily", range: [["07:00", "14:00"]], off: [3] } },
        { name: "ã‚«ãƒ•ã‚§ VIENTO", lat: 33.553961, lng: 133.515355, rating: 4.5, cat: "ã‚«ãƒ•ã‚§", color: "#e67e22", displayTime: "10:00ï½16:00", hours: { type: "viento" } },
        { name: "Tea CafÃ© Lune", lat: 33.560673, lng: 133.534987, rating: 4.2, cat: "ã‚«ãƒ•ã‚§", color: "#e67e22", displayTime: "11:00ï½18:00", hours: { type: "weekly", weekday: ["12:00", "18:00"], weekend: ["11:00", "18:00"] } },
        { name: "SPOON", lat: 33.559393, lng: 133.535541, rating: 4.1, cat: "ã‚«ãƒ•ã‚§", color: "#e67e22", displayTime: "7:00ï½18:00", hours: { type: "weekly", weekday: ["07:00", "18:00"], weekend: ["07:00", "17:00"] } },
        { name: "åœŸä½èŒ¶ã‚«ãƒ•ã‚§", lat: 33.560087, lng: 133.537253, rating: 4.0, cat: "ã‚«ãƒ•ã‚§", color: "#e67e22", displayTime: "11:00ï½17:00", hours: { type: "daily", range: [["11:00", "17:00"]], off: [3] } },
        { name: "çˆç²å°‚é–€åº— POEM", lat: 33.56078, lng: 133.541147, rating: 4.3, cat: "ã‚«ãƒ•ã‚§", color: "#e67e22", displayTime: "10:00ï½17:00", hours: { type: "weekly_poem" } },
        { name: "ã‚‰ã‚“ã·", lat: 33.561243, lng: 133.54231, rating: 4.1, cat: "ã‚«ãƒ•ã‚§", color: "#e67e22", displayTime: "10:00ï½17:00", hours: { type: "daily", range: [["10:00", "17:00"]] } },
        { name: "ã‚¯ãƒ¡ãƒ¤", lat: 33.560326, lng: 133.538392, rating: 3.2, cat: "ã‚«ãƒ•ã‚§", color: "#e67e22", displayTime: "7:00ï½18:00", hours: { type: "daily", range: [["07:00", "18:00"]] } },
        { name: "ã‚¢ãƒ³ã®åº­", lat: 33.553702, lng: 133.562549, rating: 4.0, cat: "ã‚«ãƒ•ã‚§", color: "#e67e22", displayTime: "7:00ï½17:00", hours: { type: "daily", range: [["07:00", "17:00"]] } },
        { name: "MIKKE", lat: 33.556753, lng: 133.522776, rating: 4.4, cat: "ã‚«ãƒ•ã‚§", color: "#e67e22", displayTime: "11:00ï½16:00", hours: { type: "daily", range: [["11:00", "16:00"]], off: [0,1] } },
        { name: "é¢¨è¦‹é¶", lat: 33.569517, lng: 133.506994, rating: 3.8, cat: "ãƒ¬ã‚¹ãƒˆãƒ©ãƒ³", color: "#f1c40f", displayTime: "9:00ï½21:00", hours: { type: "daily", range: [["09:00", "21:00"]] } },
        { name: "ç©€ç‰©å­¦æ ¡", lat: 33.557113, lng: 133.578962, rating: 4.0, cat: "ãƒ¬ã‚¹ãƒˆãƒ©ãƒ³", color: "#f1c40f", displayTime: "9:00ï½21:00", hours: { type: "daily", range: [["09:00", "21:00"]] } },
        { name: "ã‚ã˜ã•ã„è¡—é“", lat: 33.507142, lng: 133.466509, rating: 3.9, cat: "ãƒ¬ã‚¹ãƒˆãƒ©ãƒ³", color: "#f1c40f", displayTime: "9:00ï½21:00", hours: { type: "daily", range: [["09:00", "21:00"]] } },
        { name: "TUKI ç…®è¾¼ã¿æ–™ç†ã¨å’Œã®æ´‹é£Ÿå±‹ã•ã‚“", lat: 33.556924, lng: 133.516572, rating: 3.9, cat: "ãƒ¬ã‚¹ãƒˆãƒ©ãƒ³", color: "#f1c40f", displayTime: "11:30ï½17:00", hours: { type: "daily", range: [["11:30", "17:00"]] } },
        { name: "Hungry Bear", lat: 33.543121, lng: 133.524765, rating: 4.3, cat: "ãƒ¬ã‚¹ãƒˆãƒ©ãƒ³", color: "#f1c40f", displayTime: "11:00ï½21:30", hours: { type: "daily", range: [["11:00", "15:00"], ["17:00", "21:30"]], off: [2] } },
        { name: "ãƒŸãƒ©ãƒäº­", lat: 33.559199, lng: 133.543908, rating: 4.3, cat: "ãƒ¬ã‚¹ãƒˆãƒ©ãƒ³", color: "#f1c40f", displayTime: "11:00ï½21:00", hours: { type: "daily", range: [["11:00", "21:00"]], off: [2] } },
        { name: "ã‚ã‚‹ãºã‚“ã¯ã†ã™", lat: 33.57502, lng: 133.55212, rating: 4.0, cat: "ãƒ¬ã‚¹ãƒˆãƒ©ãƒ³", color: "#f1c40f", displayTime: "8:00ï½23:00", hours: { type: "daily", range: [["08:00", "23:00"]] } },
        { name: "ãƒ¬ã‚¹ãƒˆãƒ©ãƒ³ ãƒ”ãƒƒã‚¯", lat: 33.505556, lng: 133.54172, rating: 4.0, cat: "ãƒ¬ã‚¹ãƒˆãƒ©ãƒ³", color: "#f1c40f", displayTime: "11:30ï½20:00", hours: { type: "daily", range: [["11:30", "14:00"], ["17:30", "20:00"]], off: [2] } },
        { name: "5019 PREMIUM", lat: 33.560643, lng: 133.540149, rating: 4.0, cat: "ãƒ¬ã‚¹ãƒˆãƒ©ãƒ³", color: "#f1c40f", displayTime: "11:00ï½ / æœ¨æ›œä¼‘", hours: { type: "5019" } },
        { name: "FAMILY ASAHI", lat: 33.556031, lng: 133.50815, rating: 3.8, cat: "ãƒ¬ã‚¹ãƒˆãƒ©ãƒ³", color: "#f1c40f", displayTime: "9:00ï½20:00", hours: { type: "daily", range: [["09:00", "20:00"]], off: [1] } },
        { name: "ãƒãƒ³ã‚¸ã‚§ãƒ»ã‚µã‚µ", lat: 33.571419, lng: 133.556321, rating: 3.8, cat: "ãƒ‘ãƒ³ãƒ»ã‚±ãƒ¼ã‚­", color: "#e84393", displayTime: "9:30ï½19:00", hours: { type: "daily", range: [["09:30", "19:00"]] } },
        { name: "Mon plaisir", lat: 33.554108, lng: 133.561748, rating: 4.1, cat: "ãƒ‘ãƒ³ãƒ»ã‚±ãƒ¼ã‚­", color: "#e84393", displayTime: "10:30ï½19:00", hours: { type: "daily", range: [["10:30", "19:00"]], off: [3] } },
        { name: "CHITAPAN", lat: 33.567614, lng: 133.59948, rating: 4.2, cat: "ãƒ‘ãƒ³ãƒ»ã‚±ãƒ¼ã‚­", color: "#e84393", displayTime: "7:00ï½17:00", hours: { type: "daily", range: [["07:00", "17:00"]], off: [1] } },
        { name: "Donuts Patio", lat: 33.543507, lng: 133.51045, rating: 4.6, cat: "ãƒ‘ãƒ³ãƒ»ã‚±ãƒ¼ã‚­", color: "#e84393", displayTime: "10:00ï½18:00", hours: { type: "daily", range: [["10:00", "18:00"]], off: [1] } },
        { name: "ãŸã­ã¾ã‚‹", lat: 33.558396, lng: 133.527063, rating: 4.2, cat: "ãƒ‘ãƒ³ãƒ»ã‚±ãƒ¼ã‚­", color: "#e84393", displayTime: "8:45ï½18:30", hours: { type: "daily", range: [["08:45", "18:30"]], off: [0,1,2] } },
        { name: "Petit four", lat: 33.543345, lng: 133.509749, rating: 4.5, cat: "ãƒ‘ãƒ³ãƒ»ã‚±ãƒ¼ã‚­", color: "#e84393", displayTime: "11:00ï½19:00", hours: { type: "daily", range: [["11:00", "19:00"]], off: [2] } },
        { name: "Romande", lat: 33.567645, lng: 133.530037, rating: 4.2, cat: "ãƒ‘ãƒ³ãƒ»ã‚±ãƒ¼ã‚­", color: "#e84393", displayTime: "7:30ï½19:30", hours: { type: "weekly", weekday: ["07:30", "19:30"], weekend: ["07:30", "19:00"], off: [2] } },
        { name: "ãŠã‹ã—å±‹ ã¨ã‚“ã·ã‚Œ", lat: 33.543573, lng: 133.497826, rating: 4.6, cat: "ãƒ‘ãƒ³ãƒ»ã‚±ãƒ¼ã‚­", color: "#e84393", displayTime: "11:00ï½18:00", hours: { type: "daily", range: [["11:00", "18:00"]], off: [1,2] } }
    ];

    const map = L.map('map').setView([33.56, 133.535], 14);
    L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png').addTo(map);

    let markerLayer = L.layerGroup().addTo(map);
    let currentCategory = 'ã™ã¹ã¦';
    let currentMinRating = 0;
    let currentSort = 'high';

    function checkOpen(shop) {
        const now = new Date(); const day = now.getDay(); const time = now.getHours() * 100 + now.getMinutes();
        const h = shop.hours; if (!h) return true;
        if (h.off && h.off.includes(day)) return false;
        if (h.type === "viento") return (day >= 1 && day <= 5 && time >= 1000 && time <= 1600);
        if (h.type === "special_cafe_bon") return (time >= 1130 && time <= 2300);
        if (h.type === "5019") return (day !== 4 && time >= 1100 && time <= 1700);
        let ranges = h.type === "daily" ? h.range : (h.type === "weekly" ? ([0,6].includes(day) ? [h.weekend] : [h.weekday]) : []);
        if (h.type === "weekly_poem") ranges = (day === 6) ? [["10:00", "19:00"]] : [["10:00", "17:00"]];
        return ranges.some(r => (time >= parseInt(r[0].replace(':','')) && time <= parseInt(r[1].replace(':',''))));
    }

    function applyFilters() {
        markerLayer.clearLayers();
        const list = document.getElementById('shop-list');
        list.innerHTML = '';

        // ãƒ•ã‚£ãƒ«ã‚¿ãƒªãƒ³ã‚°ï¼ˆã‚«ãƒ†ã‚´ãƒª + è©•ä¾¡ã‚¹ã‚³ã‚¢ï¼‰
        let filtered = locations.filter(loc => 
            (currentCategory === 'ã™ã¹ã¦' || loc.cat === currentCategory) && 
            (loc.rating >= currentMinRating)
        );

        // ã‚½ãƒ¼ãƒˆ
        filtered.sort((a, b) => (currentSort === 'high' ? b.rating - a.rating : a.rating - b.rating));

        filtered.forEach(loc => {
            const isOpen = checkOpen(loc);
            const statusHtml = isOpen ? '<span class="status-badge open">å–¶æ¥­ä¸­</span>' : '<span class="status-badge closed">æº–å‚™ä¸­</span>';
            const catColorClass = loc.cat === 'ãƒ¬ã‚¹ãƒˆãƒ©ãƒ³' ? 'cat-yellow' : '';

            const marker = L.circleMarker([loc.lat, loc.lng], { radius: 8, fillColor: loc.color, color: "#fff", weight: 2, opacity: 1, fillOpacity: 0.8 });
            marker.bindPopup(`<strong>${loc.name}</strong> ${statusHtml}<br>â˜…${loc.rating}`).addTo(markerLayer);

            const item = document.createElement('div');
            item.className = 'shop-item';
            item.innerHTML = `
                <div><span class="cat-badge ${catColorClass}" style="background-color:${loc.color}">${loc.cat}</span><strong>${loc.name}</strong>${statusHtml}</div>
                <div style="font-size:0.85em;color:#f39c12;margin-top:4px;">â˜…${loc.rating.toFixed(1)}</div>
                <div class="time-text">ğŸ•’ ${loc.displayTime}</div>`;
            item.onclick = () => { map.flyTo([loc.lat, loc.lng], 16); marker.openPopup(); };
            list.appendChild(item);
        });
    }

    function updateCategory(cat, btn) {
        document.querySelectorAll('.cat-f').forEach(b => b.classList.remove('active'));
        btn.classList.add('active');
        currentCategory = cat;
        applyFilters();
    }

    function updateRating(rat, btn) {
        document.querySelectorAll('.rat-f').forEach(b => b.classList.remove('active'));
        btn.classList.add('active');
        currentMinRating = rat;
        applyFilters();
    }

    function updateSort(val) {
        currentSort = val;
        applyFilters();
    }

    applyFilters();
</script>
</body>
</html>
